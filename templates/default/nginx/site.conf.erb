<% if @site['ssl'] %>
server {
  server_name <%= @site['server_names'].join(' ') %>;
  listen 443;

  ssl on;
  ssl_certificate <%= File.join(@site['root'], 'ssl', 'certs', "#{@name}.pem") %>;
  ssl_certificate_key <%= File.join(@site['root'], 'ssl', 'keys', "#{@name}.key") %>;
  ssl_session_timeout 5m;

  ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
  ssl_ciphers HIGH:!aNULL:!MD5;
  ssl_prefer_server_ciphers on;

}

<% end %>
server {
  server_name <%= @site['server_names'].join(' ') %>;
  listen 80;

  gzip on;
  gzip_disable "msie6";
  
  gzip_vary on;
  gzip_proxied any;
  gzip_comp_level 6;
  gzip_buffers 16 8k;
  gzip_http_version 1.1;
  gzip_types text/plain text/css application/json application/x-javascript text/xml application/xml application/xml+rss text/javascript application/javascript;
}
