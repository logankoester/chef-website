<% if @site['ssl'] %>
server {
  listen 443;
  server_name <%= @site['server_names'].join(' ') %>;
  root <%= File.join(@site['root'], @site['web_root']) %>;

<%= render 'nginx/ssl.conf.erb', :variables => {
  cert_path: File.join(@site['root'], 'ssl', 'certs', "#{@name}.pem"),
  key_path: File.join(@site['root'], 'ssl', 'keys', "#{@name}.key")
} %>

<%= render 'nginx/php.conf.erb', :variables => {
  name: @name,
  site: @site
} if @site['php'] %>

  include <%= File.join(@site['root'], 'nginx/*.conf') %>;
}

<% end %>
server {
  listen 80;
  server_name <%= @site['server_names'].join(' ') %>;
  root <%= File.join(@site['root'], @site['web_root']) %>;

<%= render 'nginx/php.conf.erb', :variables => {
  name: @name,
  site: @site
} if @site['php'] %>

  include <%= File.join(@site['root'], 'nginx/*.conf') %>;
}
