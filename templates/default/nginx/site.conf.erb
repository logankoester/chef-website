<% if @site['ssl'] %>
server {
  listen 443;
  server_name <%= @site['server_names'].join(' ') %>;
  root <%= File.join(@site['root'], @site['web_root']) %>;

<%= render 'nginx/ssl.conf.erb', :variables => {
  cert_path: File.join(@site['root'], 'ssl', 'certs', "#{@name}.pem"),
  key_path: File.join(@site['root'], 'ssl', 'keys', "#{@name}.key")
} %>

<%= render 'nginx/static.conf.erb' %>

<%= render 'nginx/gzip.conf.erb' if @site['gzip'] %>

<%= render 'nginx/php.conf.erb', :variables => {
  name: @name,
  site: @site
} if @site['php'] %>

<%= render 'nginx/wordpress.conf.erb', :variables => {
  name: @name,
  site: @site
} if @site['wordpress'] %>

<%= render 'nginx/wordpress_wp_super_cache.conf.erb' if @site['wordpress'] && @site['wordpress']['wp_super_cache'] %>
}

<% end %>
server {
  listen 80;
  server_name <%= @site['server_names'].join(' ') %>;
  root <%= File.join(@site['root'], @site['web_root']) %>;

<%= render 'nginx/static.conf.erb' %>

<%= render 'nginx/gzip.conf.erb' if @site['gzip'] %>

<%= render 'nginx/php.conf.erb', :variables => {
  name: @name,
  site: @site
} if @site['php'] %>

<%= render 'nginx/wordpress.conf.erb', :variables => {
  name: @name,
  site: @site
} if @site['wordpress'] %>

<%= render 'nginx/wordpress_wp_super_cache.conf.erb' if @site['wordpress'] && @site['wordpress']['wp_super_cache'] %>
}
